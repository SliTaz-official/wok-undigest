# SliTaz package receipt.

PACKAGE="busybox-boot"
VERSION="1.19.1"
CATEGORY="base-system"
SHORT_DESC="Many common UNIX utilities for core-5in1/boot flavor."
MAINTAINER="pascal.bellard@slitaz.org"
DEPENDS="slitaz-base-files slitaz-boot-scripts linux syslinux"
WANTED="busybox"
WEB_SITE="http://www.busybox.net/"
CONFIG_FILES=""

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
    mkdir -p $fs/bin $fs/etc/init.d
    cp -a $src/busybox-static $fs/bin/busybox
    ln -s bin/busybox $fs/init
    cat > $fs/etc/init.d/rcS <<EOT
#!/bin/busybox sh
for i in \$(busybox --list) ; do busybox ln /bin/busybox /bin/\$i; done
for i in /sbin /usr/bin /usr/sbin ; do ln -s /bin \$i; done
mount proc
[ -d /proc/bus/usb ] && mount -t usbfs usbfs /proc/bus/usb
mount sys
ifconfig lo 127.0.0.1
ifconfig eth0 0.0.0.0 up
udhcpc -b
busybox | sed '/Current/,\$!d'
EOT
    # Udhcpc stuff.
    mkdir -p $fs/usr/share/udhcpc
    cp $WOK/$WANTED/stuff/udhcp.script $fs/usr/share/udhcpc/default.script
    chmod +x $fs/usr/share/udhcpc/default.script $fs/etc/init.d/rcS
}

pre_install()
{
	rm -rf $1/usr $1/bin
}

post_install()
{
	rm -rf $1/lib $1/var $1/sbin $1/home $1/root $1/media
	sed -i 's|sbin/getty.*|bin/sh|;/tty[3-9]/d' $1/etc/inittab
}
